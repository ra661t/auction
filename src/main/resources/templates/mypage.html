<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .container {
            max-width: 960px;
            margin: 30px auto;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .user-info img {
            border-radius: 10px;
        }
        .tab-link {
            padding: 8px 12px;
            background: #f0f0f0;
            border-radius: 5px;
            margin-right: 8px;
            text-decoration: none;
            color: #333;
        }
        .tab-link:hover {
            background: #ddd;
            text-decoration: none;
        }
        .form-inline input,
        .form-inline select,
        .form-inline button {
            margin-right: 10px;
        }
        .form-inline {
            margin-bottom: 20px;
        }
        .badge {
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
<!-- âœ… ìƒë‹¨ ë‚´ë¹„ê²Œì´ì…˜ -->
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">ğŸ  EasyBid</a>

        <div class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/mypage}">ë§ˆì´í˜ì´ì§€</a>
                </li>
                <li class="nav-item">
                    <form th:action="@{/logout}" method="post" class="d-inline">
                        <button class="btn btn-outline-secondary btn-sm" type="submit">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <h2 class="mb-4">ë§ˆì´í˜ì´ì§€</h2>

    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <div class="mb-4 user-info">
        <p><strong>ì´ë©”ì¼:</strong> <span th:text="${user.email}">ì´ë©”ì¼</span></p>
        <p><strong>ì´ë¦„:</strong> <span th:text="${user.name}">ì´ë¦„</span></p>
        <p><strong>ì „í™”ë²ˆí˜¸:</strong> <span th:text="${user.phone}">ì „í™”ë²ˆí˜¸</span></p>
        <div th:if="${user.imageUrl}">
            <img th:src="${user.imageUrl}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" width="150" height="150">
        </div>
        <div th:if="${user.imageUrl == null}">
            <p class="text-muted">ë“±ë¡ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <hr>

    <!-- ê²€ìƒ‰ ë° í•„í„° -->
    <form th:action="@{/mypage}" method="get" class="form-inline d-flex flex-wrap align-items-center">
        <input type="text" class="form-control form-control-sm" name="keyword" placeholder="ìƒí’ˆëª… ê²€ìƒ‰" th:value="${keyword}" />
        <select name="sort" class="form-select form-select-sm">
            <option value="latest" th:selected="${sort == 'latest'}">ìµœì‹ ìˆœ</option>
            <option value="priceDesc" th:selected="${sort == 'priceDesc'}">ì…ì°°ê°€ ë†’ì€ìˆœ</option>
            <option value="priceAsc" th:selected="${sort == 'priceAsc'}">ì…ì°°ê°€ ë‚®ì€ìˆœ</option>
        </select>
        <div class="form-check mx-2">
            <input class="form-check-input" type="checkbox" name="winnerOnly" th:checked="${winnerOnly}" id="winnerOnlyCheck"/>
            <label class="form-check-label" for="winnerOnlyCheck">ë‚™ì°°ë§Œ ë³´ê¸°</label>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">ê²€ìƒ‰</button>
    </form>

    <!-- íƒ­ ë§í¬ -->
    <div class="mb-3">
        <a th:href="@{/mypage(tab='bids')}" class="tab-link">ğŸ“ ì…ì°°í•œ ë‚´ì—­</a>
        <a th:href="@{/mypage(tab='winners')}" class="tab-link">ğŸ† ë‚™ì°° ë‚´ì—­</a>
        <a th:href="@{/mypage(tab='payments')}" class="tab-link">ğŸ’³ ê²°ì œ ì™„ë£Œ</a>
    </div>

    <!-- ì…ì°° ë‚´ì—­ í…Œì´ë¸” -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-light">
            <tr>
                <th>ìƒí’ˆëª…</th>
                <th>ì…ì°°ê°€</th>
                <th>ì…ì°° ì‹œê°„</th>
                <th>ê²½ë§¤ ìƒíƒœ</th>
                <th>ë‚™ì°° ì—¬ë¶€</th>
                <th>ê²°ì œ</th>
                <th>ì·¨ì†Œ</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="bid : ${myBids}">
                <td><a th:href="@{/items/{id}(id=${bid.item.id})}" th:text="${bid.item.itemName}">ìƒí’ˆëª…</a></td>
                <td th:text="${#numbers.formatDecimal(bid.bidPrice, 0, 'COMMA', 2, 'POINT')} + ' ì›'"></td>
                <td th:text="${#temporals.format(bid.bidTime, 'yyyy-MM-dd HH:mm')}">ì‹œê°„</td>
                <td><span class="badge bg-info text-dark" th:text="${bid.item.auctionStatus}">ACTIVE</span></td>
                <td>
                    <span th:if="${bid.item.endTime > T(java.time.LocalDateTime).now()}">-</span>
                    <span th:if="${bid.item.endTime <= T(java.time.LocalDateTime).now()}">
                        <span th:if="${bid.winner}" class="badge bg-success">âœ… ë‚™ì°°</span>
                        <span th:if="${!bid.winner}" class="badge bg-secondary">âŒ ì‹¤íŒ¨</span>
                    </span>
                </td>
                <td>
                    <div th:if="${bid.item.endTime <= T(java.time.LocalDateTime).now()}">
                        <div th:if="${bid.winner}">
                            <div th:if="${bid.paymentStatus != null}">
                                <div th:switch="${bid.paymentStatus.name()}">
                                    <div th:case="'PENDING'">
                                        <form th:action="@{/payments/form}" method="get">
                                            <input type="hidden" name="itemId" th:value="${bid.item.id}" />
                                            <button type="submit" class="btn btn-sm btn-success">ğŸ’³ ê²°ì œí•˜ê¸°</button>
                                        </form>
                                    </div>
                                    <div th:case="'COMPLETED'">
                                        <span class="badge bg-success">âœ… ê²°ì œ ì™„ë£Œ</span>
                                    </div>
                                    <div th:case="*">
                                        <span class="text-muted">-</span>
                                    </div>
                                </div>
                            </div>
                            <div th:if="${bid.paymentStatus == null}">
                                <span class="text-muted">-</span>
                            </div>
                        </div>
                        <div th:if="${!bid.winner}">
                            <span class="text-muted">-</span>
                        </div>
                    </div>
                </td>
                <td>
                    <form th:if="${bid.item.endTime > T(java.time.LocalDateTime).now()}" th:action="@{/bids/cancel}" method="post">
                        <input type="hidden" name="bidId" th:value="${bid.id}" />
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('ì •ë§ ì…ì°°ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì·¨ì†Œ</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(myBids)}">
                <td colspan="7" class="text-center text-muted">ì…ì°°í•œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
